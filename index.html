<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P&L / ОПиУ для производства: Управленческий подход</title>
    <meta name="description" content="Руководство по составлению управленческого отчета о прибылях и убытках для производственного предприятия. Калькулятор P&L и структура показателей.">
    
    <meta property="og:title" content="P&L для производства: Управленческий отчет">
    <meta property="og:description" content="Как читать и составлять отчет о прибыли. Структура, формулы, онлайн-калькулятор EBITDA.">
    <meta property="og:type" content="website">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Manrope:wght@500;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Palette */
            --primary: #0f172a; /* Slate 900 */
            --primary-light: #334155;
            --accent: #2563eb; /* Blue 600 */
            --accent-hover: #1d4ed8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            
            /* Backgrounds */
            --bg-body: #f8fafc;
            --bg-card: #ffffff;
            --bg-section: #f1f5f9;

            /* Text */
            --text-main: #1e293b;
            --text-muted: #64748b;
            
            /* UI Elements */
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --container-width: 1140px;
            --header-height: 70px;
        }

        /* --- Reset & Base --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        html { scroll-behavior: smooth; }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        h1, h2, h3, h4 {
            font-family: 'Manrope', sans-serif;
            font-weight: 700;
            line-height: 1.2;
            color: var(--primary);
        }

        a { text-decoration: none; color: inherit; transition: color 0.2s; }
        ul { list-style: none; }
        
        .container {
            max-width: var(--container-width);
            margin: 0 auto;
            padding: 0 20px;
        }

        section { padding: 80px 0; border-bottom: 1px solid #e2e8f0; }

        /* --- Components --- */
        .btn {
            display: inline-block;
            background: var(--accent);
            color: white;
            padding: 14px 28px;
            border-radius: var(--radius);
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
        }
        .btn:hover { background: var(--accent-hover); transform: translateY(-2px); }

        .tag {
            display: inline-block;
            background: #e0f2fe;
            color: #0369a1;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .formula-box {
            background: #f8fafc;
            border: 1px dashed #cbd5e1;
            padding: 12px;
            border-radius: 8px;
            font-family: monospace;
            color: var(--primary);
            margin: 16px 0;
            display: inline-block;
            font-weight: 600;
        }

        /* --- Header --- */
        header {
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            border-bottom: 1px solid #e2e8f0;
            height: var(--header-height);
            display: flex;
            align-items: center;
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .logo { font-size: 1.25rem; font-weight: 800; display: flex; align-items: center; gap: 8px; }
        .logo svg { color: var(--accent); }

        .nav-links { display: flex; gap: 24px; }
        .nav-links a { font-size: 0.95rem; font-weight: 500; color: var(--text-muted); }
        .nav-links a:hover { color: var(--accent); }

        /* --- Hero --- */
        .hero {
            padding: 100px 0 80px;
            background: radial-gradient(circle at top right, #f0f9ff, white);
        }
        .hero-content { max-width: 800px; }
        .hero h1 { font-size: clamp(2rem, 5vw, 3.5rem); margin-bottom: 20px; }
        .hero p { font-size: 1.15rem; color: var(--text-muted); margin-bottom: 30px; }
        
        .standards-note {
            background: #fff;
            border-left: 4px solid var(--accent);
            padding: 20px;
            border-radius: 0 var(--radius) var(--radius) 0;
            box-shadow: var(--shadow);
            margin-bottom: 32px;
            font-size: 0.95rem;
        }
        .standards-note strong { color: var(--primary); }

        /* --- Grid & Cards --- */
        .grid-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-top: 40px;
        }

        .card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid #f1f5f9;
            transition: transform 0.2s;
            position: relative;
            overflow: hidden;
        }
        .card:hover { transform: translateY(-5px); border-color: #e2e8f0; }
        
        .card-icon {
            width: 40px;
            height: 40px;
            background: #eff6ff;
            color: var(--accent);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .card h3 { margin-bottom: 12px; font-size: 1.25rem; }
        .card p { font-size: 0.95rem; color: var(--text-muted); margin-bottom: 12px; }
        
        /* Specific borders for logic flow */
        .border-left-accent { border-left: 4px solid var(--accent); }
        .border-left-success { border-left: 4px solid var(--success); }
        .border-left-warning { border-left: 4px solid var(--warning); }

        /* --- Calculator --- */
        .calc-section { background-color: var(--primary); color: white; }
        .calc-section h2 { color: white; }
        .calc-section p { color: #94a3b8; }

        .calc-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            background: white;
            padding: 40px;
            border-radius: var(--radius);
            color: var(--text-main);
        }

        .input-group { margin-bottom: 16px; }
        .input-group label { display: block; font-size: 0.9rem; font-weight: 600; margin-bottom: 6px; color: var(--primary-light); }
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.2s;
        }
        .input-group input:focus { outline: none; border-color: var(--accent); }

        .results-panel {
            background: #f8fafc;
            padding: 24px;
            border-radius: var(--radius);
            border: 1px solid #e2e8f0;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px dashed #cbd5e1;
        }
        .result-row.total { border-bottom: none; border-top: 2px solid var(--text-main); margin-top: 10px; padding-top: 20px; }
        .result-row .label { font-weight: 500; }
        .result-row .value { font-weight: 700; font-size: 1.1rem; }
        
        .bar-chart { margin-top: 30px; }
        .bar-group { margin-bottom: 15px; }
        .bar-label { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 4px; font-weight: 600; }
        .bar-track { width: 100%; height: 10px; background: #e2e8f0; border-radius: 5px; overflow: hidden; }
        .bar-fill { height: 100%; background: var(--accent); width: 0; transition: width 0.5s ease-out; }

        /* --- Accordion/FAQ --- */
        .accordion-item { border-bottom: 1px solid #e2e8f0; }
        .accordion-btn {
            width: 100%;
            padding: 20px 0;
            text-align: left;
            background: none;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            color: var(--text-muted);
        }
        .accordion-content p { padding-bottom: 20px; }

        /* --- Footer --- */
        footer { background: white; padding: 40px 0; border-top: 1px solid #e2e8f0; text-align: center; }
        .footer-links { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
        .disclaimer { font-size: 0.8rem; color: #94a3b8; max-width: 600px; margin: 0 auto; }

        /* --- Back to Top --- */
        #backToTop {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 45px;
            height: 45px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 99;
            font-size: 1.2rem;
        }
        #backToTop.visible { opacity: 1; pointer-events: all; }

        /* --- Mobile --- */
        @media (max-width: 768px) {
            .nav-links { display: none; } /* Simplified for demo */
            .hero h1 { font-size: 2rem; }
            .calc-container { grid-template-columns: 1fr; padding: 20px; }
        }
    </style>
</head>
<body>

<header>
    <div class="container">
        <nav>
            <a href="#" class="logo">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                FinMan Pro
            </a>
            <div class="nav-links">
                <a href="#structure">Структура</a>
                <a href="#calculator">Калькулятор</a>
                <a href="#faq">Вопросы</a>
            </div>
        </nav>
    </div>
</header>

<main>
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <span class="tag">Для предпринимателей и производства</span>
                <h1>P&L / ОПиУ: Управленческий подход</h1>
                <p>Как считать реальную прибыль, а не «бухгалтерскую». Пошаговое руководство по структуре отчета о прибылях и убытках для производственной компании.</p>
                
                <div class="standards-note">
                    <strong>⚠️ Важное отличие:</strong> Это пример <em>управленческого</em> отчета. 
                    <ul style="margin-top: 10px; list-style: disc; padding-left: 20px; color: var(--text-muted);">
                        <li>Он отличается от стандартов РСБУ (ФСБУ 4/2023, Приказ №157н) и МСФО (IAS 1, IFRS 18).</li>
                        <li>Цель этого отчета — показать экономику бизнеса для принятия решений, а не сдать налоговую декларацию.</li>
                        <li>Мы группируем расходы по их поведению (переменные/постоянные), а не только по функции.</li>
                    </ul>
                </div>

                <a href="#structure" class="btn">Перейти к структуре отчета</a>
            </div>
        </div>
    </section>

    <section id="structure">
        <div class="container">
            <h2>Структура управленческого P&L</h2>
            <p style="margin-bottom: 30px; color: var(--text-muted);">Следуйте по шагам сверху вниз, чтобы понять, как формируется Чистая прибыль.</p>
            
            <div class="grid-cards">
                
                <div class="card border-left-accent">
                    <div class="card-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></div>
                    <h3>1. Выручка (Revenue)</h3>
                    <p>Начисленный доход от отгруженной продукции.</p>
                    <div class="formula-box">Цена × Объем продаж</div>
                    <p><small>❌ Ошибка: Считать деньги в кассе (авансы). Выручка признается в момент перехода прав на товар (отгрузка).</small></p>
                </div>

                <div class="card">
                    <div class="card-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"/><line x1="16" y1="8" x2="2" y2="22"/><line x1="17.5" y1="15" x2="9" y2="15"/></svg></div>
                    <h3>2. Переменные издержки (COGS/Variable)</h3>
                    <p>Расходы, которые напрямую зависят от объема выпуска. Если завод стоит — эти расходы = 0.</p>
                    <ul>
                        <li>• Сырье и материалы</li>
                        <li>• Сдельная зарплата рабочих</li>
                        <li>• Упаковка, прямая логистика</li>
                    </ul>
                </div>

                <div class="card border-left-success">
                    <div class="card-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg></div>
                    <h3>3. Маржинальный доход</h3>
                    <p>Сколько денег приносит каждая проданная единица после вычета сырья.</p>
                    <div class="formula-box">Выручка − Переменные издержки</div>
                    <p><strong>Маржинальность:</strong> (МД / Выручка) × 100%.</p>
                </div>

                <div class="card">
                    <div class="card-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 21h18M5 21V7l8-4 8 4v14M8 21v-2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></div>
                    <h3>4. Постоянные производственные</h3>
                    <p>Расходы <strong>цеха</strong>, которые не зависят от выпуска в моменте.</p>
                    <ul>
                        <li>• Аренда производственных площадей</li>
                        <li>• Оклад начальника цеха, мастеров, технологов</li>
                        <li>• Ремонт и обслуживание станков (фиксированное)</li>
                    </ul>
                </div>

                <div class="card border-left-success">
                    <div class="card-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M16 8l-8 8"/><path d="M8 8l8 8"/></svg></div>
                    <h3>5. Валовая прибыль (Gross Profit)</h3>
                    <p>Эффективность именно <strong>производственной модели</strong> бизнеса.</p>
                    <div class="formula-box">Марж. доход − Пост. производственные</div>
                    <p>Показывает, окупает ли производство само себя без учета офиса.</p>
                </div>

                <div class="card">
                    <div class="card-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg></div>
                    <h3>6. Операционные (OpEx)</h3>
                    <p>Коммерческие, общие и административные расходы.</p>
                    <ul>
                        <li>• Офис, бухгалтерия, юристы</li>
                        <li>• Маркетинг и продажи (отдел продаж)</li>
                        <li>• IT, связь, представительские</li>
                    </ul>
                </div>

                <div class="card border-left-warning">
                    <div class="card-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></div>
                    <h3>7. EBITDA</h3>
                    <p>Операционная прибыль до вычета процентов, налогов и амортизации.</p>
                    <div class="formula-box">Валовая − OpEx</div>
                    <p>Главный индикатор "здоровья" основного бизнеса. <br>⚠️ Не равна деньгам на счете!</p>
                </div>

                <div class="card">
                    <div class="card-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg></div>
                    <h3>8. Амортизация, % и Налоги</h3>
                    <p><strong>Амортизация:</strong> "Виртуальный" расход, износ оборудования.<br>
                    <strong>Проценты:</strong> Плата банку за кредиты.<br>
                    <strong>Налог на прибыль:</strong> Платежи государству.</p>
                </div>

                <div class="card border-left-success" style="background: #f0fdf4; border-color: #bbf7d0;">
                    <div class="card-icon" style="color: #15803d; background: #dcfce7;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg></div>
                    <h3>9. Чистая прибыль (Net Income)</h3>
                    <p>Итоговый результат собственника.</p>
                    <div class="formula-box">EBITDA − Амортизация − % − Налоги</div>
                    <p>Именно из этой суммы выплачиваются дивиденды.</p>
                </div>

            </div>
        </div>
    </section>

    <section id="calculator" class="calc-section">
        <div class="container">
            <h2 style="margin-bottom: 40px; text-align: center;">P&L Калькулятор</h2>
            <div class="calc-container">
                
                <div class="calc-inputs">
                    <h3 style="margin-bottom: 20px; color: var(--primary);">Ввод данных (за месяц)</h3>
                    
                    <div class="input-group">
                        <label>1. Выручка</label>
                        <input type="number" id="in-rev" value="5000000" min="0">
                    </div>

                    <div class="input-group">
                        <label>2. Переменные издержки (Сырье, сделка)</label>
                        <input type="number" id="in-var" value="2500000" min="0">
                    </div>

                    <div class="input-group">
                        <label>4. Постоянные производственные (Цех)</label>
                        <input type="number" id="in-fix-mfg" value="800000" min="0">
                    </div>

                    <div class="input-group">
                        <label>6. Операционные расходы (Офис, Маркетинг)</label>
                        <input type="number" id="in-opex" value="700000" min="0">
                    </div>

                    <div class="input-group">
                        <label>8. Амортизация + Проценты + Налоги</label>
                        <input type="number" id="in-others" value="400000" min="0">
                    </div>
                </div>

                <div class="results-panel">
                    <h3 style="margin-bottom: 20px;">Результат</h3>
                    
                    <div class="result-row">
                        <span class="label">Выручка</span>
                        <span class="value" id="out-rev">0</span>
                    </div>

                    <div class="result-row">
                        <span class="label" style="color: var(--accent);">3. Маржинальный доход</span>
                        <span class="value" id="out-md">0</span>
                    </div>
                    
                    <div class="result-row">
                        <span class="label" style="color: var(--success);">5. Валовая прибыль</span>
                        <span class="value" id="out-gp">0</span>
                    </div>

                    <div class="result-row">
                        <span class="label" style="color: var(--warning);">7. EBITDA</span>
                        <span class="value" id="out-ebitda">0</span>
                    </div>
                    
                    <div class="result-row total">
                        <span class="label">9. Чистая прибыль</span>
                        <span class="value" id="out-net" style="color: var(--success); font-size: 1.3rem;">0</span>
                    </div>

                    <div class="bar-chart">
                        <div class="bar-group">
                            <div class="bar-label"><span>Маржинальная рент. (к Выручке)</span><span id="lbl-md-perc">0%</span></div>
                            <div class="bar-track"><div class="bar-fill" id="bar-md" style="width: 0%; background: var(--accent);"></div></div>
                        </div>
                        <div class="bar-group">
                            <div class="bar-label"><span>Валовая рент. (к Выручке)</span><span id="lbl-gp-perc">0%</span></div>
                            <div class="bar-track"><div class="bar-fill" id="bar-gp" style="width: 0%; background: var(--success);"></div></div>
                        </div>
                        <div class="bar-group">
                            <div class="bar-label"><span>EBITDA Margin</span><span id="lbl-ebitda-perc">0%</span></div>
                            <div class="bar-track"><div class="bar-fill" id="bar-ebitda" style="width: 0%; background: var(--warning);"></div></div>
                        </div>
                        <div class="bar-group">
                            <div class="bar-label"><span>Чистая рентабельность</span><span id="lbl-net-perc">0%</span></div>
                            <div class="bar-track"><div class="bar-fill" id="bar-net" style="width: 0%; background: #10b981;"></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="faq">
        <div class="container">
            <h2 style="margin-bottom: 30px;">Частые вопросы</h2>
            
            <div class="accordion-item">
                <button class="accordion-btn">Чем валовая прибыль отличается от маржинальной? <span>+</span></button>
                <div class="accordion-content">
                    <p>В нашем управленческом формате: Маржинальная = Выручка − Переменные (сырье). Валовая = Маржинальная − Постоянные производственные (цех). Валовая показывает результат работы завода в целом, а маржинальная — эффективность продаж и материалоемкость.</p>
                </div>
            </div>

            <div class="accordion-item">
                <button class="accordion-btn">Почему EBITDA не равна деньгам? <span>+</span></button>
                <div class="accordion-content">
                    <p>EBITDA — это "бумажная" операционная прибыль. Деньги могут быть заморожены в запасах на складе или в дебиторской задолженности (клиент не заплатил). Также из EBITDA еще нужно отдать кредиты и налоги.</p>
                </div>
            </div>

            <div class="accordion-item">
                <button class="accordion-btn">Куда относить зарплату директора завода? <span>+</span></button>
                <div class="accordion-content">
                    <p>Если директор управляет именно производством — в Постоянные производственные расходы. Если генеральный директор всей компании — в Операционные расходы (OPEX/Офис).</p>
                </div>
            </div>
        </div>
    </section>

    <section id="summary" style="background: var(--bg-section);">
        <div class="container" style="text-align: center;">
            <h2>Главный вывод</h2>
            <p style="max-width: 700px; margin: 20px auto 0;">
                Не смешивайте личные деньги и деньги бизнеса. Не путайте остаток на счете с прибылью. 
                Составляйте P&L ежемесячно по методу начисления, чтобы видеть реальную эффективность вашей бизнес-модели.
            </p>
        </div>
    </section>

</main>

<footer>
    <div class="container">
        <div class="footer-links">
            <a href="#">Политика конфиденциальности</a>
            <a href="#">О проекте</a>
        </div>
        <p class="disclaimer">
            Материал носит ознакомительный характер. Терминология упрощена для управленческих целей.<br>
            Для официальной отчетности руководствуйтесь ФСБУ 4/2023 (РФ) или IFRS / IAS 1 (Международные стандарты).
        </p>
        <p style="margin-top: 20px; font-size: 0.9rem;">&copy; 2024 FinMan Pro. Все права защищены.</p>
    </div>
</footer>

<button id="backToTop" aria-label="Наверх">↑</button>

<script>
    // --- Calculator Logic ---
    function calculatePnL() {
        // Get Inputs
        const rev = parseFloat(document.getElementById('in-rev').value) || 0;
        const variable = parseFloat(document.getElementById('in-var').value) || 0;
        const fixMfg = parseFloat(document.getElementById('in-fix-mfg').value) || 0;
        const opex = parseFloat(document.getElementById('in-opex').value) || 0;
        const others = parseFloat(document.getElementById('in-others').value) || 0;

        // Calculations Logic
        const md = rev - variable;
        const gp = md - fixMfg; // Managerial Gross Profit
        const ebitda = gp - opex;
        const net = ebitda - others;

        // Helper to format numbers
        const fmt = (num) => new Intl.NumberFormat('ru-RU').format(Math.round(num));

        // Update Text Outputs
        document.getElementById('out-rev').innerText = fmt(rev);
        document.getElementById('out-md').innerText = fmt(md);
        document.getElementById('out-gp').innerText = fmt(gp);
        document.getElementById('out-ebitda').innerText = fmt(ebitda);
        document.getElementById('out-net').innerText = fmt(net);

        // Calculate Percentages for Bars
        const getPerc = (val) => {
            if (rev === 0) return 0;
            return Math.max(0, Math.min(100, (val / rev) * 100));
        };

        const mdPerc = getPerc(md);
        const gpPerc = getPerc(gp);
        const ebitdaPerc = getPerc(ebitda);
        const netPerc = getPerc(net);

        // Update Bars
        document.getElementById('bar-md').style.width = mdPerc + '%';
        document.getElementById('bar-gp').style.width = gpPerc + '%';
        document.getElementById('bar-ebitda').style.width = ebitdaPerc + '%';
        document.getElementById('bar-net').style.width = netPerc + '%';

        // Update Labels
        document.getElementById('lbl-md-perc').innerText = Math.round((md/rev)*100 || 0) + '%';
        document.getElementById('lbl-gp-perc').innerText = Math.round((gp/rev)*100 || 0) + '%';
        document.getElementById('lbl-ebitda-perc').innerText = Math.round((ebitda/rev)*100 || 0) + '%';
        document.getElementById('lbl-net-perc').innerText = Math.round((net/rev)*100 || 0) + '%';
    }

    // Attach Listeners
    const inputs = document.querySelectorAll('input');
    inputs.forEach(input => {
        input.addEventListener('input', calculatePnL);
    });

    // Initial calculation
    calculatePnL();

    // --- Accordion Logic ---
    const accBtns = document.querySelectorAll('.accordion-btn');
    accBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            this.classList.toggle('active');
            const content = this.nextElementSibling;
            if (content.style.maxHeight) {
                content.style.maxHeight = null;
                this.querySelector('span').innerText = '+';
            } else {
                content.style.maxHeight = content.scrollHeight + "px";
                this.querySelector('span').innerText = '−';
            }
        });
    });

    // --- Back to Top ---
    const backToTopBtn = document.getElementById('backToTop');
    window.addEventListener('scroll', () => {
        if (window.scrollY > 300) {
            backToTopBtn.classList.add('visible');
        } else {
            backToTopBtn.classList.remove('visible');
        }
    });
    backToTopBtn.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });

</script>

</body>
</html>
